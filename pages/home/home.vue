<template>
  <view class="page">
		<homenav></homenav>
	    <!-- æœç´¢ -->
		<!-- <view class="head-info">
		  <view class="head-search">
		
			<view class="search" @click="onSearch">
			  <view class="icon">
				<image src="/static/fdj_ico.png" mode=""></image>
			  </view>
			  <view class="hint">
				<text class="max">æœç´¢Naturecan</text>
				<text class="min">æ›´å¤šæµ·å¤–å•†å“ç­‰æ‚¨æ¥</text>
				
			  </view>
			</view>
			 
			<view class="icon-info" @click="onSkip('my')">
			  <text class="cuIcon-people"></text>
			</view>
			<uni-popup ref="popup" :is-mask-click="false">
			  <view class="popcss">
				<view class="locale-setting"
				  >å½“å‰è¯­è¨€:{{ $t("index.language") }}</view
				>
				<view class="locale-list">
				  <view
					class="locale-item"
					v-for="(item, index) in locales"
					:key="index"
					@click="onLocaleChange(item)"
				  >
					<text class="text">{{ item.text }}</text>
					<text
					  class="iconfont icon-check"
					  v-if="item.code == applicationLocale"
					></text>

				  </view>
				</view>
				<view class="closebtn" @click="close"> å…³é—­ </view>

			  </view>
			</uni-popup>
		  </view>
		  

		  <view class="classify-list">
			<view
			  class="list"
			  v-for="(item, index) in classList"
			  :class="{ action: classifyShow == index }"
			  @click="onClassify(item, index)"
			  :key="index"
			>
			  <text>{{ item.name }}</text>
			  <text class="line" v-show="classifyShow == index"></text>
			</view>
		  </view>
		</view> -->
      <view class="main" >
        <!-- banner -->
        <view class="banner">
          <swiper
            class="screen-swiper square-dot"
            indicator-dots="true"
            circular="true"
            autoplay="true"
            interval="5000"
            duration="500"
          >
            <swiper-item v-for="(item, index) in swiperList" :key="index">
              <image :src="item.url" mode="aspectFill"></image>
              <!-- <video src="{{item.url}}" autoplay loop muted show-play-btn="{{false}}" controls="{{false}}" objectFit="cover" wx:if="{{item.type=='video'}}"></video> -->
            </swiper-item>
          </swiper>
        </view>
        <view class="procat">
        	<view class="protitle">
        		å•†å“åˆ†ç±»
        	</view>
			<view class="list" >
				<view class="li" v-for="(item, index) in classList" @click="gotype(item)">
					<image class="li-img" :src="item.coverImg" ></image>
					<text >
						{{item.name}}
					</text>
				</view>
			</view>
        </view>
		<view class="procat">
			<view class="protitle">
				ç•…é”€å•å“
			</view>
			<view class="list" >
				<view class="li2" v-for="(item, index) in goodsList" @click="godetails(item.id)">
					<image class="li-img" :src="item.productImgs" ></image>
					<text class="title">
						{{item.productTitle}}
					</text>
					<text class="price">ï¿¥{{item.productPrice}}</text>
					<view class="cart">
						<text class="iconfont icon-cart"></text>ç«‹å³è´­ä¹°
					</view>
				</view>
			</view>
		</view>  
		<view class="procat">
			<view class="protitle">
				æ–°å“ä¸Šå¸‚
			</view>
			<view class="list" >
				<view class="li2" v-for="(item, index) in goodsList2" @click="godetails(item.id)">
					<image class="li-img" :src="item.productImgs" ></image>
					<text class="title">
						{{item.productTitle}}
					</text>
					<text class="price">ï¿¥{{item.productPrice}}</text>
					<view class="cart">
						<text class="iconfont icon-cart"></text>ç«‹å³è´­ä¹°
					</view>
				</view>
			</view>
		</view>
		<view class="homejieshao">
			<view class="li">
				<image class="mubiao" src="/static/hometxt.png" mode=""></image>
			</view>
			<view class="li">
				<image class="jimg1" src="/static/j.png" mode=""></image>
				<text>æ— è½¬åŸºå› </text>
			</view>
			<view class="li">
				<image class="jimg2" src="/static/j1.png" mode=""></image>
				<text>å®¢æˆ·è‡³ä¸Š</text>
			</view>
			<view class="li">
				<image class="jimg2" src="/static/j2.png" mode=""></image>
				<text>ä¸–ç•Œé¢†å…ˆç³»åˆ—</text>
			</view>
			<view class="li">
				<image class="jimg2" src="/static/j3.png" mode=""></image>
				<text>å¯æŒç»­æ€§</text>
			</view>
			<view class="li">
				<image class="jimg2" src="/static/j4.png" mode=""></image>
				<text>å›½é™…é…é€</text>
			</view>
		</view>
		<view class="aboutme">
			<view class="li">
				<image class="aboutimg1" src="/static/a1.webp" mode=""></image>
			</view>
			<view class="li">
				<image class="aboutimg1" src="/static/a2.webp" mode=""></image>
			</view>
			<view class="li">
				<image class="aboutimg2" src="/static/a3.webp" mode=""></image>
				<image class="aboutimg2" src="/static/a4.webp" mode=""></image>
			</view>
			<view class="li">
				<image class="aboutimg3" src="/static/a5.webp" mode=""></image>
				<image class="aboutimg4" src="/static/a6.webp" mode=""></image>
			</view>
		</view>
		<view class="copyright">
			Â© 2022, Naturecan Ltd - Bank Chambers, Stockport, SK1 1AR, UK
		</view>
		<view class="china">
			ğŸ‡¨ğŸ‡³ CHINA
		</view>
		<view class="smallabout">
			This product is not for use by or sale to persons under the age of 18. This product should be used only as directed on the label. It should not be used if you are pregnant or nursing. Consult with a physician before use if you have a serious medical condition or use prescription medications. A Doctor's advice should be sought before using this and any supplemental dietary product. All trademarks and copyrights are property of their respective owners and are not affiliated with nor do they endorse this product. These statements have not been evaluated by the FDA. This product is not intended to diagnose, treat, cure or prevent any disease. Individual weight loss results will vary. By using this site, you agree to follow the Privacy Policy and all Terms & Conditions printed on this site. Void Where Prohibited by Law.
		</view>
       
		<!-- ä»Šæ—¥ä¸Šæ–° -->
        <!-- <view class="new-product">
          <view class="product-title">
            <view class="title">
              <image src="/static/hr_ico.png"></image>
              <text>ä»Šæ—¥ä¸Šæ–°1å…ƒæŠ¢è´­</text>
            </view>
            <view class="describe">
              <text class="cuIcon-roundright"></text>
            </view>
          </view>
          <view class="goods-list"  
		  >
            <view class="list" v-for="(item, index) in goodsList"
              @click="godetails(item.id)"
              :key="index" >
              <view class="pictrue">
                <image :src="item.productImgs"></image>
              </view>
			 <view class="price-title">
			  	{{item.productTitle}}
			  </view>	
			  <view class="price-start">
			  	<u-rate :value="item.startnumber" active-color="#2f6669" inactive-color="#b2b2b2" :allowHalf="false"></u-rate> {{item.startnumber}}
			  </view>
              <view class="price" @click="godetails(item.id)">
				  <text class="original-price">ç‰¹ä»·</text>
                <text class="selling-price">ï¿¥{{item.productPrice}}</text>

              </view>
            </view>
            
          </view>
        </view> -->
		<!-- ä¸ºä½ æ¨è -->
        <!-- <view class="recommend-info">
          <view class="recommend-title">
            <view class="title">
              <image src="/static/wntj_title.png" mode=""></image>
            </view>
          </view>
          <view class="goods-list">
            <view
              class="list"
              v-for="(item, index) in goodsList2"
              @click="godetails(item.id)"
              :key="index"
            >
              <view class="pictrue">
                <image
                  :src="item.productImgs"
                  mode="heightFix"
                ></image>
              </view>
              <view class="title-tag">
                <view class="tag">
                  <text v-if="item.productPrice == 1">ç‰¹ä»·</text>
                  {{ item.productTitle }}
                </view>
              </view>
			 <view class="price-start">
			 	<u-rate :value="item.startnumber" active-color="#2f6669" inactive-color="#b2b2b2" :allowHalf="false"></u-rate> {{item.startnumber}}
			 </view>	
              <view class="price-info">
                <view class="user-price">
                  <text class="min">ï¿¥</text>
                  <text class="max">{{ item.productPrice }}</text>
                </view>
                <view class="vip-price">

                </view>
              </view>
            </view>
          </view>
		  <uni-load-more :status="status"></uni-load-more>

		  
        </view> -->
		
      </view>
	  
    <!-- </mescroll-body> -->
	
	
  </view>
</template>

<script>

import ClassifyData from "../../components/ClassifyData/ClassifyData.vue";
// å¼•å…¥mescroll-mixins.js
// import MescrollMixin from "@/components/mescroll-uni/mescroll-mixins.js";
import { findProductList,findProductCat ,findBannerList,lastAcitiy,findKefu} from "../../api/index";
	import homenav from "../../components/homenav.vue";//åˆ¤æ–­ç”¨æˆ·ä¿¡æ¯
import __config from "../../config/env.js";
export default {
  // mixins: [MescrollMixin], // ä½¿ç”¨mixin
  components: {
    homenav
  },
  data() {
    return {
		keyword:'',
		searchshow:false,
		navshow:false,
		HalfValue:5,
      action: __config.imgaction, // å›¾ç‰‡æ˜¾ç¤ºåœ°å€
      imgaction: __config.oldurl, // å›¾ç‰‡æ˜¾ç¤ºåœ°å€
      mescroll: null, // mescrollå®ä¾‹å¯¹è±¡ (æ­¤è¡Œå¯åˆ ,mixinså·²é»˜è®¤)
      // ä¸‹æ‹‰åˆ·æ–°çš„é…ç½®(å¯é€‰, ç»å¤§éƒ¨åˆ†æƒ…å†µæ— éœ€é…ç½®)
      downOption: {},
      // ä¸Šæ‹‰åŠ è½½çš„é…ç½®(å¯é€‰, ç»å¤§éƒ¨åˆ†æƒ…å†µæ— éœ€é…ç½®)
      upOption: {
        use: false,
      },
      swiperList: [
        {
          id: 0,
          type: "image",
          url: "/static/banner1.png",
        },
        {
          id: 1,
          type: "image",
          url: "/static/banner2.png",
        },
        {
          id: 2,
          type: "image",
          url: "/static/banner3.png",
        },
        {
          id: 3,
          type: "image",
          url: "/static/banner4.png",
        },
      ],
      slideNum: 0,
      navList: [
        {
          id: 1,
          name: "æ‰‹æœºä¸“åŒº",
        },
        {
          id: 2,
          name: "æ½®ç‰Œç”·è£…",
        },
        
      ],
      classList: [
        {
          id: 0,
          name: "é¦–é¡µ",
        }
        
      ],
      goodsList: [],
      goodsList2: [],
      classifyShow: 0,
      // é¡µé¢é«˜åº¦
      pageHeight: 500,
	  lasttime:'',//æ´»åŠ¨å¼€å§‹æ—¶
	  downtime:'',//å€’è®¡æ—¶
	  typeid:0,
	  timeData:{},
	  nowTime: [], // å½“å‰æ—¶é—´
	  status: 'more',
	  pagesize:10,
	  pageNo:1,
    };
  },
  onReady() {
    uni.hideTabBar();
    // #ifdef MP
    uni.setNavigationBarTitle({
      title: "é¦–é¡µ",
    });
    uni.setNavigationBarColor({
      frontColor: "#ffffff",
      backgroundColor: "#C9934C",
    });
    // #endif
  },
  computed: {
    locales() {
      return [
        {
          text: this.$t("locale.auto"),
          code: "auto",
        },
        {
          text: this.$t("locale.en"),
          code: "en",
        },
        {
          text: this.$t("locale.zh-hans"),
          code: "zh-Hans",
        },
        {
          text: this.$t("locale.zh-hant"),
          code: "zh-Hant",
        },
        {
          text: this.$t("locale.ja"),
          code: "ja",
        },
      ];
    },
  },
  onLoad() {
	  
    let systemInfo = uni.getSystemInfoSync();
    this.systemLocale = systemInfo.language;
    this.applicationLocale = uni.getLocale();
    this.isAndroid = systemInfo.platform.toLowerCase() === "android";
    uni.onLocaleChange((e) => {
      this.applicationLocale = e.locale;
    });

    this.funFindProductList(this.typeid);
	this.checkprotypelist()

  },
  onShow() {
  	// this.funFindProductList(this.typeid);
  	this.checkprotypelist()

  },

  onPageScroll(e) {
    let scrollTop = e.scrollTop;
    if (scrollTop > 0) {
      this.pageHeight = 210;
    } else {
      this.pageHeight = 500;
    }
  },
  onReachBottom() {
    console.log(12333);
  },
  mounted(){
      this.$nextTick(() => { // åŠ¨æ€æ—¶é—´å±•ç¤º
      	setInterval(this.showTime, 1000);
		setInterval(this.checktime, 60000);
		
      });
    },
  methods: {
	  //æœç´¢å•†å“
	  searchapi(){
		  uni.navigateTo({
		  	url:'/pages/SearchGoodsList/SearchGoodsList?keyword='+this.keyword
		  })
	  },
	  //å‰å¾€å•†å“åˆ†ç±»
	  gotype(item){

		 uni.navigateTo({
		 	url:'./hometype?typeid='+item.id+'&typename='+item.name
		 }) 
	  },
	  //å›åˆ°é¦–é¡µ
	  gohome(){
		 uni.reLaunch({
		 	url:'/pages/home/home'
		 }) 
	  },
	  
	 
	 
	  kefu() {
			findKefu().then((res)=>{
				console.log(res.result)
				window.location.href="https://chatlink.mstatik.com/widget/standalone.html?eid="+res.result
			})
		  
	  },
	  
	  async checkprotypelist(){
		  let _this = this
		  //å•†å“åˆ†ç±»
		  findProductCat().then((res)=>{
			  let data = []
			   res.result.forEach(function (item, index) {
				   let li = {}
				           li.id = item.id
							li.name = item.productCatName
							li.coverImg = _this.imgaction+'/'+item.coverImg
							data.push(li)
			   });
			   this.classList = data
		  })
		  //bannerå›¾
		  findBannerList().then((res)=>{
			  let data = []
			   res.result.forEach(function (item, index) {
				   let li = {}
				   li.url = _this.imgaction+'/'+item.bannerImgSrc

					data.push(li)
			   });
				this.swiperList = data
		  })
	  },
	  //å•†å“è¯¦æƒ…é¡µè·³è½¬
	  godetails(id){
		  uni.navigateTo({
		  	url:'/pages/GoodsDetails/GoodsDetails?id='+id
		  })
	  },
	  //ä¸‹æ‹‰åŠ è½½
	  onReachBottom() {
	  	// this.pageNo +=1
		// this.funFindProductList(this.typeid);
	  	uni.$u.toast("ä¸Šæ‹‰è§¦å‘",this.pageNo)
	  	//è¿™æ˜¯ä¸Šæ‹‰è§¦å‘çš„å‡½æ•°.ä¸€èˆ¬åœ¨è¿™é‡Œè¿›è¡Œåˆ†é¡µæ“ä½œ. 
	      /*ä¼šæœ‰ä¸€ç§æƒ…å†µå°±æ˜¯å½“æ•°æ®å·²ç»å…¨éƒ¨åŠ è½½å®Œæˆäº†,å†æ¬¡è§¦åº•è¿˜ä¼šè°ƒç”¨æ¥å£,
	        è¿™æ—¶å°±éœ€è¦å»è®°å½•ä¸€ä¸‹æ˜¯å¦å·²ç»å…¨éƒ¨åŠ è½½å®Œæ¯•,åŠ è½½å®Œæ¯•å°±ä¸å»è¯·æ±‚æ¥å£äº†.
	        è¿™æ—¶æœ€å¸¸è§çš„èŠ‚æµåœºæ™¯*/
	  },
    //   å•†å“åˆ—è¡¨
    async funFindProductList(typeid) {
		const  res  = await findProductList({catId:typeid,pageNo:this.pageNo,pageSize:this.pagesize,isTop:'Y'})
			
			for (let i = 0; i < res.result.records.length; i++) {
				
				let imglist = res.result.records[i].productImgs.split(",")
				res.result.records[i].productImgs = this.action + '/' +imglist[0]
				res.result.records[i].startnumber = (Math.random()*(5-4.7)+4.7).toFixed(1)
			}
			this.goodsList = this.goodsList.concat(res.result.records)
			
		const  res2  = await findProductList({catId:typeid,pageNo:this.pageNo,pageSize:this.pagesize})
			
			for (let i = 0; i < res2.result.records.length; i++) {
				
				let imglist = res2.result.records[i].productImgs.split(",")
				res2.result.records[i].productImgs = this.action + '/' +imglist[0]
				res2.result.records[i].startnumber = (Math.random()*(5-4.5)+4.5).toFixed(1)
			}
			if(res2.result.records.length == 0){
				this.status = 'no-more'
			}
			this.goodsList2 = this.goodsList2.concat(res2.result.records)

		
		
		
     
    },

    openlan() {
      this.$refs.popup.open("center");
    },
    close() {
      location.reload();

      this.$refs.popup.close();
    },
    onLocaleChange(e) {
      console.log(e);
      if (this.isAndroid) {
        uni.showModal({
          content: this.$t("index.language-change-confirm"),
          success: (res) => {
            if (res.confirm) {
              uni.setLocale(e.code);
            }
          },
        });
      } else {
        uni.setLocale(e.code);
        this.$i18n.locale = e.code;
      }
    },
    /*ä¸‹æ‹‰åˆ·æ–°çš„å›è°ƒ, æœ‰ä¸‰ç§å¤„ç†æ–¹å¼:*/
    downCallback() {
      // this.mescroll.endSuccess();
    },
    /*ä¸Šæ‹‰åŠ è½½çš„å›è°ƒ*/
    upCallback(page) {
      setTimeout(() => {
        this.mescroll.endByPage(10, 20);
      }, 2000);
    },
    /**
     * èœå•å¯¼èˆªæ»šåŠ¨
     */
    ScrollMenu(e) {
      let scrollLeft = e.target.scrollLeft;
      const query = uni.createSelectorQuery().in(this);
      query
        .select(".nav")
        .boundingClientRect((data) => {
          let wid = e.target.scrollWidth - data.width - (data.left * 2 + 5);
          this.slideNum = ((scrollLeft / wid) * 300) / 2;
        })
        .exec();
    },
    /**
     * æœç´¢ç‚¹å‡»
     */
    onSearch() {
      uni.navigateTo({ url: "/pages/search/search" });
    },
    /**
     * æ‰«ä¸€æ‰«ç‚¹å‡»
     */
    onCode() {
      // åªå…è®¸é€šè¿‡ç›¸æœºæ‰«ç 
      uni.scanCode({
        onlyFromCamera: true,
        success: function (res) {
          console.log("æ¡ç ç±»å‹ï¼š" + res.scanType);
          console.log("æ¡ç å†…å®¹ï¼š" + res.result);
        },
      });
    },
    /**
     * åˆ†ç±»ç‚¹å‡»
     * @param {Object} item
     * @param {Number} index
     */
    async onClassify(item, index) {
      this.classifyShow = index;
	  this.goodsList = []
	  this.goodsList2 = []
	  this.typeid = item.id
	  this.status = 'more'
	  
	  this.pageNo = 1
	  this.pagesize = 10
	  await this.funFindProductList(item.id);
	  
	  console.log(item)

	  	
	  uni.pageScrollTo({
	  	scrollTop: 0,
	  	duration: 1000
	  });
	  
    },
	//ç§’è½¬æ¢æ—¶åˆ†ç§’
	getTimem(time) {
	            // è½¬æ¢ä¸ºå¼åˆ†ç§’
	            let h = parseInt(time / 60 / 60 % 24)
	            h = h < 10 ?  h : h
	            let m = parseInt(time / 60 % 60)
	             m = m < 10 ?  m : m
	            let s = parseInt(time % 60)
	             s = s < 10 ?  s : s
	            // ä½œä¸ºè¿”å›å€¼è¿”å›
	            return [h, m, s]
	},
	showTime() { // åŠ¨æ€å±•ç¤ºç°åœ¨æ—¶é—´
				
		   var date = new Date();
		   var year = date.getFullYear();
		   var month = date.getMonth() + 1;
		   month = month < 10 ? "0" + month : month;
		   var day = date.getDate();
		   day = day < 10 ? "0" + day : day;
		   var week = "æ—¥ä¸€äºŒä¸‰å››äº”å…­".charAt(date.getDay()); // ä½¿ç”¨charAtå‡½æ•°æå–ç›¸åº”æ±‰å­—
		   var hour = date.getHours();
		   hour = hour < 10 ? "0" + hour : hour; // ç”¨ä¸‰ç›®è¿ç®—ç¬¦è°ƒæ•´æ•°å­—æ˜¾ç¤ºæ ¼å¼
		   var minute = date.getMinutes();
		   minute = minute < 10 ? "0" + minute : minute;
		   var second = date.getSeconds();
		   second = second < 10 ? "0" + second : second;
		   // åŠ è½½ç°åœ¨æ—¶é—´
		   var current =  hour + ":" + minute + ":" + second;
			   	this.nowTime = [hour,minute,second];
			   
		 },
    /**
     * è·³è½¬ç‚¹å‡»
     * @param {String} type è·³è½¬ç±»å‹
     */
    onSkip(type) {
      switch (type) {
	  case "my":
		uni.navigateTo({
		  url: "/pages/my/my",
		});
		break;
        case "mess":
          uni.navigateTo({
            url: "/pages/Message/Message",
          });
          break;
        case "paycode":
          uni.navigateTo({
            url: "/pages/PaymentCode/PaymentCode",
          });
          break;
        case "menu":
          uni.navigateTo({
            url: "/pages/SearchGoodsList/SearchGoodsList",
          });
          break;
        case "inform":
          break;
        case "flash":
          uni.navigateTo({
            url: "/pages/FlashSale/FlashSale",
          });
          break;
        case "GoodChoice":
          uni.navigateTo({
            url: "/pages/GoodChoice/GoodChoice",
          });
          break;
        case "goods":
          uni.navigateTo({
            url: "/pages/GoodsDetails/GoodsDetails",
            animationType: "zoom-fade-out",
            animationDuration: 200,
          });
          break;
      }
    },
  },
};
</script>

<style scoped lang="scss">
@import "home.scss";
</style>
