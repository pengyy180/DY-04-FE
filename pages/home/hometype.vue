<template>
  <view class="page">
		<homenav></homenav>
	    
      <view class="main" >
        <!-- banner -->
		<view class="procat">
			<view class="protitle">
				{{typename}}
			</view>
			<view class="list" >
				<view class="li3" v-for="(item, index) in goodsList2" @click="godetails(item.id)">
					<image class="li-img" :src="item.productImgs" ></image>
					<text class="title">
						{{item.productTitle}}
					</text>
					<text class="price">ï¿¥{{item.productPrice}}</text>
					<view class="cart">
						<text class="iconfont icon-cart"></text>ç«‹å³è´­ä¹°
					</view>
				</view>
			</view>
		</view>  
		<view class="limitpage" >
			<view class="icon" @click="uppage()">
				â†
			</view>
			<view class="pages">
				Page {{pageNo}} of {{pagetotal}}
			</view>
			<view class="icon" @click="nextpage()">
				â†’
			</view>
		</view>
		<view class="homejieshao">
			<view class="li">
				<image class="mubiao" src="/static/hometxt.png" mode=""></image>
			</view>
			<view class="li">
				<image class="jimg1" src="/static/j.png" mode=""></image>
				<text>æ— è½¬åŸºå› </text>
			</view>
			<view class="li">
				<image class="jimg2" src="/static/j1.png" mode=""></image>
				<text>å®¢æˆ·è‡³ä¸Š</text>
			</view>
			<view class="li">
				<image class="jimg2" src="/static/j2.png" mode=""></image>
				<text>ä¸–ç•Œé¢†å…ˆç³»åˆ—</text>
			</view>
			<view class="li">
				<image class="jimg2" src="/static/j3.png" mode=""></image>
				<text>å¯æŒç»­æ€§</text>
			</view>
			<view class="li">
				<image class="jimg2" src="/static/j4.png" mode=""></image>
				<text>å›½é™…é…é€</text>
			</view>
		</view>
		<view class="aboutme">
			<view class="li">
				<image class="aboutimg1" src="/static/a1.webp" mode=""></image>
			</view>
			<view class="li">
				<image class="aboutimg1" src="/static/a2.webp" mode=""></image>
			</view>
			<view class="li">
				<image class="aboutimg2" src="/static/a3.webp" mode=""></image>
				<image class="aboutimg2" src="/static/a4.webp" mode=""></image>
			</view>
			<view class="li">
				<image class="aboutimg3" src="/static/a5.webp" mode=""></image>
				<image class="aboutimg4" src="/static/a6.webp" mode=""></image>
			</view>
		</view>
		<view class="copyright">
			Â© 2022, Naturecan Ltd - Bank Chambers, Stockport, SK1 1AR, UK
		</view>
		<view class="china">
			ğŸ‡¨ğŸ‡³ CHINA
		</view>
		<view class="smallabout">
			This product is not for use by or sale to persons under the age of 18. This product should be used only as directed on the label. It should not be used if you are pregnant or nursing. Consult with a physician before use if you have a serious medical condition or use prescription medications. A Doctor's advice should be sought before using this and any supplemental dietary product. All trademarks and copyrights are property of their respective owners and are not affiliated with nor do they endorse this product. These statements have not been evaluated by the FDA. This product is not intended to diagnose, treat, cure or prevent any disease. Individual weight loss results will vary. By using this site, you agree to follow the Privacy Policy and all Terms & Conditions printed on this site. Void Where Prohibited by Law.
		</view>
       
		<!-- ä»Šæ—¥ä¸Šæ–° -->
        <!-- <view class="new-product">
          <view class="product-title">
            <view class="title">
              <image src="/static/hr_ico.png"></image>
              <text>ä»Šæ—¥ä¸Šæ–°1å…ƒæŠ¢è´­</text>
            </view>
            <view class="describe">
              <text class="cuIcon-roundright"></text>
            </view>
          </view>
          <view class="goods-list"  
		  >
            <view class="list" v-for="(item, index) in goodsList"
              @click="godetails(item.id)"
              :key="index" >
              <view class="pictrue">
                <image :src="item.productImgs"></image>
              </view>
			 <view class="price-title">
			  	{{item.productTitle}}
			  </view>	
			  <view class="price-start">
			  	<u-rate :value="item.startnumber" active-color="#2f6669" inactive-color="#b2b2b2" :allowHalf="false"></u-rate> {{item.startnumber}}
			  </view>
              <view class="price" @click="godetails(item.id)">
				  <text class="original-price">ç‰¹ä»·</text>
                <text class="selling-price">ï¿¥{{item.productPrice}}</text>

              </view>
            </view>
            
          </view>
        </view> -->
		<!-- ä¸ºä½ æ¨è -->
        <!-- <view class="recommend-info">
          <view class="recommend-title">
            <view class="title">
              <image src="/static/wntj_title.png" mode=""></image>
            </view>
          </view>
          <view class="goods-list">
            <view
              class="list"
              v-for="(item, index) in goodsList2"
              @click="godetails(item.id)"
              :key="index"
            >
              <view class="pictrue">
                <image
                  :src="item.productImgs"
                  mode="heightFix"
                ></image>
              </view>
              <view class="title-tag">
                <view class="tag">
                  <text v-if="item.productPrice == 1">ç‰¹ä»·</text>
                  {{ item.productTitle }}
                </view>
              </view>
			 <view class="price-start">
			 	<u-rate :value="item.startnumber" active-color="#2f6669" inactive-color="#b2b2b2" :allowHalf="false"></u-rate> {{item.startnumber}}
			 </view>	
              <view class="price-info">
                <view class="user-price">
                  <text class="min">ï¿¥</text>
                  <text class="max">{{ item.productPrice }}</text>
                </view>
                <view class="vip-price">

                </view>
              </view>
            </view>
          </view>
		  <uni-load-more :status="status"></uni-load-more>

		  
        </view> -->
		
      </view>
	  
    <!-- </mescroll-body> -->
	
	
	
    <!-- <ClassifyData v-show="classifyShow != 0" ></ClassifyData> -->
    <!-- tabbar -->
	<!-- <checkdata></checkdata> -->
    <!-- <TabBar :tabBarShow="0"></TabBar> -->
  </view>
</template>

<script>
import TabBar from "../../components/TabBar/TabBar.vue";
import ClassifyData from "../../components/ClassifyData/ClassifyData.vue";
// å¼•å…¥mescroll-mixins.js
// import MescrollMixin from "@/components/mescroll-uni/mescroll-mixins.js";
import { findProductList,findProductCat ,findBannerList,lastAcitiy,findKefu} from "../../api/index";
	import homenav from "../../components/homenav.vue";//åˆ¤æ–­ç”¨æˆ·ä¿¡æ¯
import __config from "../../config/env.js";
export default {
  // mixins: [MescrollMixin], // ä½¿ç”¨mixin
  components: {
    TabBar,
    ClassifyData,
	homenav	
  },
  data() {
    return {
	  navshow:false,
	  HalfValue:5,
      action: __config.imgaction, // å›¾ç‰‡æ˜¾ç¤ºåœ°å€
      imgaction: __config.oldurl, // å›¾ç‰‡æ˜¾ç¤ºåœ°å€
      mescroll: null, // mescrollå®ä¾‹å¯¹è±¡ (æ­¤è¡Œå¯åˆ ,mixinså·²é»˜è®¤)
      // ä¸‹æ‹‰åˆ·æ–°çš„é…ç½®(å¯é€‰, ç»å¤§éƒ¨åˆ†æƒ…å†µæ— éœ€é…ç½®)
      downOption: {},
      // ä¸Šæ‹‰åŠ è½½çš„é…ç½®(å¯é€‰, ç»å¤§éƒ¨åˆ†æƒ…å†µæ— éœ€é…ç½®)
      classList: [
        {
          id: 0,
          name: "é¦–é¡µ",
        }
        
      ],
      goodsList: [],
      goodsList2: [],
      classifyShow: 0,
      // é¡µé¢é«˜åº¦
      pageHeight: 500,
	  lasttime:'',//æ´»åŠ¨å¼€å§‹æ—¶
	  downtime:'',//å€’è®¡æ—¶
	  typeid:0,
	  timeData:{},
	  nowTime: [], // å½“å‰æ—¶é—´
	  status: 'more',
	  pagesize:2,
	  pageNo:1,
	  pagetotal:0,
	  typename:'',
	  typeid:''
    };
  },
  
  
  onLoad(option) {
	
	this.typename = option.typename
	this.typeid = option.typeid
    this.funFindProductList(this.typeid,this.pageNo,this.pagesize);
	this.checkprotypelist()

  },
  onShow() {
  	
  },

  onPageScroll(e) {
    let scrollTop = e.scrollTop;
    if (scrollTop > 0) {
      this.pageHeight = 210;
    } else {
      this.pageHeight = 500;
    }
  },
  onReachBottom() {
    console.log(12333);
  },
  mounted(){
      this.$nextTick(() => { // åŠ¨æ€æ—¶é—´å±•ç¤º
      	setInterval(this.showTime, 1000);
		setInterval(this.checktime, 60000);
		
      });
    },
  methods: {
	  uppage(){
		  if(this.pageNo > 1){
			  this.pageNo -=1
			  this.funFindProductList(this.typeid,this.pageNo,this.pagesize);
			  uni.pageScrollTo({
			  	scrollTop: 0,
			  	duration: 1000
			  });
		  }
	  },
	  nextpage(){
		  if(this.pageNo <= this.pagesize ){
			  this.pageNo +=1
			  this.funFindProductList(this.typeid,this.pageNo,this.pagesize);
			  uni.pageScrollTo({
			  	scrollTop: 0,
			  	duration: 1000
			  });
		  }
	  },
	  //å‰å¾€å•†å“åˆ†ç±»
	  gotype(item){
	  
	  		 uni.navigateTo({
	  		 	url:'./hometype?typeid='+item.id+'&typename='+item.name
	  		 }) 
	  },
	  gohome(){
		 uni.reLaunch({
		 	url:'/pages/home/home'
		 }) 
	  },
	
	  //å®¢æœ
	  kefu() {
			findKefu().then((res)=>{
				console.log(res.result)
				window.location.href="https://chatlink.mstatik.com/widget/standalone.html?eid="+res.result
			})
		  
	  },
	  
	  async checkprotypelist(){
		  let _this = this
		  //å•†å“åˆ†ç±»
		  findProductCat().then((res)=>{
			  let data = []
			   res.result.forEach(function (item, index) {
				   let li = {}
				           li.id = item.id
							li.name = item.productCatName
							li.coverImg = _this.imgaction+'/'+item.coverImg
							data.push(li)
			   });
			   this.classList = data
		  })
		 
	  },
	  //å•†å“è¯¦æƒ…é¡µè·³è½¬
	  godetails(id){
		  uni.navigateTo({
		  	url:'/pages/GoodsDetails/GoodsDetails?id='+id
		  })
	  },
	  //ä¸‹æ‹‰åŠ è½½
	  onReachBottom() {
	 //  	this.pageNo +=1
		// this.funFindProductList(this.typeid);
	 //  	uni.$u.toast("ä¸Šæ‹‰è§¦å‘",this.pageNo)
	  	//è¿™æ˜¯ä¸Šæ‹‰è§¦å‘çš„å‡½æ•°.ä¸€èˆ¬åœ¨è¿™é‡Œè¿›è¡Œåˆ†é¡µæ“ä½œ. 
	      /*ä¼šæœ‰ä¸€ç§æƒ…å†µå°±æ˜¯å½“æ•°æ®å·²ç»å…¨éƒ¨åŠ è½½å®Œæˆäº†,å†æ¬¡è§¦åº•è¿˜ä¼šè°ƒç”¨æ¥å£,
	        è¿™æ—¶å°±éœ€è¦å»è®°å½•ä¸€ä¸‹æ˜¯å¦å·²ç»å…¨éƒ¨åŠ è½½å®Œæ¯•,åŠ è½½å®Œæ¯•å°±ä¸å»è¯·æ±‚æ¥å£äº†.
	        è¿™æ—¶æœ€å¸¸è§çš„èŠ‚æµåœºæ™¯*/
	  },
    //   å•†å“åˆ—è¡¨
    async funFindProductList(typeid,pageNo,pagesize) {
		console.log(typeid)
			
		const  res2  = await findProductList({catId:typeid,pageNo:pageNo,pageSize:pagesize})
			
			
			
			for (let i = 0; i < res2.result.records.length; i++) {
				
				let imglist = res2.result.records[i].productImgs.split(",")
				res2.result.records[i].productImgs = this.action + '/' +imglist[0]
				res2.result.records[i].startnumber = (Math.random()*(5-4.5)+4.5).toFixed(1)
			}
			// this.pageNo = res2.result.current
			this.pagetotal = res2.result.pages
			
			this.goodsList2 = res2.result.records

		
		
		
     
    },

    openlan() {
      this.$refs.popup.open("center");
    },
    close() {
      location.reload();

      this.$refs.popup.close();
    },
    onLocaleChange(e) {
      console.log(e);
      if (this.isAndroid) {
        uni.showModal({
          content: this.$t("index.language-change-confirm"),
          success: (res) => {
            if (res.confirm) {
              uni.setLocale(e.code);
            }
          },
        });
      } else {
        uni.setLocale(e.code);
        this.$i18n.locale = e.code;
      }
    },
    /*ä¸‹æ‹‰åˆ·æ–°çš„å›è°ƒ, æœ‰ä¸‰ç§å¤„ç†æ–¹å¼:*/
    downCallback() {
      // this.mescroll.endSuccess();
    },
    /*ä¸Šæ‹‰åŠ è½½çš„å›è°ƒ*/
    upCallback(page) {
      setTimeout(() => {
        this.mescroll.endByPage(10, 20);
      }, 2000);
    },
   
    /**
     * æœç´¢ç‚¹å‡»
     */
    onSearch() {
      uni.navigateTo({ url: "/pages/search/search" });
    },
    
    /**
     * åˆ†ç±»ç‚¹å‡»
     * @param {Object} item
     * @param {Number} index
     */
    async onClassify(item, index) {
      this.classifyShow = index;
	  this.goodsList = []
	  this.goodsList2 = []
	  this.typeid = item.id
	  this.status = 'more'
	  
	  this.pageNo = 1
	  this.pagesize = 10
	  await this.funFindProductList(item.id);
	  
	  console.log(item)

	  	
	  uni.pageScrollTo({
	  	scrollTop: 0,
	  	duration: 1000
	  });
	  
    },
	//ç§’è½¬æ¢æ—¶åˆ†ç§’
	getTimem(time) {
	            // è½¬æ¢ä¸ºå¼åˆ†ç§’
	            let h = parseInt(time / 60 / 60 % 24)
	            h = h < 10 ?  h : h
	            let m = parseInt(time / 60 % 60)
	             m = m < 10 ?  m : m
	            let s = parseInt(time % 60)
	             s = s < 10 ?  s : s
	            // ä½œä¸ºè¿”å›å€¼è¿”å›
	            return [h, m, s]
	},
	showTime() { // åŠ¨æ€å±•ç¤ºç°åœ¨æ—¶é—´
				
		   var date = new Date();
		   var year = date.getFullYear();
		   var month = date.getMonth() + 1;
		   month = month < 10 ? "0" + month : month;
		   var day = date.getDate();
		   day = day < 10 ? "0" + day : day;
		   var week = "æ—¥ä¸€äºŒä¸‰å››äº”å…­".charAt(date.getDay()); // ä½¿ç”¨charAtå‡½æ•°æå–ç›¸åº”æ±‰å­—
		   var hour = date.getHours();
		   hour = hour < 10 ? "0" + hour : hour; // ç”¨ä¸‰ç›®è¿ç®—ç¬¦è°ƒæ•´æ•°å­—æ˜¾ç¤ºæ ¼å¼
		   var minute = date.getMinutes();
		   minute = minute < 10 ? "0" + minute : minute;
		   var second = date.getSeconds();
		   second = second < 10 ? "0" + second : second;
		   // åŠ è½½ç°åœ¨æ—¶é—´
		   var current =  hour + ":" + minute + ":" + second;
			   	this.nowTime = [hour,minute,second];
			   
		 },
    /**
     * è·³è½¬ç‚¹å‡»
     * @param {String} type è·³è½¬ç±»å‹
     */
    onSkip(type) {
      switch (type) {
	  case "my":
		uni.navigateTo({
		  url: "/pages/my/my",
		});
		break;
        case "mess":
          uni.navigateTo({
            url: "/pages/Message/Message",
          });
          break;
        case "paycode":
          uni.navigateTo({
            url: "/pages/PaymentCode/PaymentCode",
          });
          break;
        case "menu":
          uni.navigateTo({
            url: "/pages/SearchGoodsList/SearchGoodsList",
          });
          break;
        case "inform":
          break;
        case "flash":
          uni.navigateTo({
            url: "/pages/FlashSale/FlashSale",
          });
          break;
        case "GoodChoice":
          uni.navigateTo({
            url: "/pages/GoodChoice/GoodChoice",
          });
          break;
        case "goods":
          uni.navigateTo({
            url: "/pages/GoodsDetails/GoodsDetails",
            animationType: "zoom-fade-out",
            animationDuration: 200,
          });
          break;
      }
    },
  },
};
</script>

<style scoped lang="scss">
@import "home.scss";
</style>
